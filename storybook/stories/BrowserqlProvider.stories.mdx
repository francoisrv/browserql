import { Meta, Story, Canvas, ArgsTable } from '@storybook/addon-docs/blocks'
import { BrowserqlProvider, BrowserqlQuery } from '../../packages/react/src'
import gql from 'graphql-tag'

<Meta
  title="react/Provider"
  component={BrowserqlProvider}
  argTypes={{
    schema: {
      name: 'GraphQL schema',
      description: 'A valid GraphQL schema',
      control: 'text',
    },
  }}
/>

export const Template = (args) => (
  <BrowserqlProvider
    schema={gql`
      extend type Query {
        sayHello: String
      }
    `}
    queries={{
      sayHello() {
        return 'Browserql Provider is working!'
      },
    }}
    extensions={[{ schema: args.schema }]}
    renderError={args.renderError}
  >
    <BrowserqlQuery
      query={gql`
        query {
          sayHello
        }
      `}
      renderError="ERROR"
      renderLoading={<div>LOADING</div>}
      render={(res) => <b>{res}</b>}
    />
  </BrowserqlProvider>
)

# Browserql Provider

Use this provider to use browserql in React

## Usage

```jsx
import React from 'react'
import { BrowserqlProvider, BrowserqlQuery } from '@browserql/react'
import gql from 'graphql-tag'

export default function App() {
  return (
    <BrowserqlProvider
      // Your schema here
      schema={gql`
        extend type Query {
          check: String
        }
      `}
      // Your queries here
      queries={{
        check() {
          return 'Browserql Provider is working!'
        },
      }}
    >
      /* You are now inside the apollo client so you can use apollo hooks or
      other like our Query component */
      <BrowserqlQuery
        query={gql`
          query {
            check
          }
        `}
        renderError={(error) => <div>{error.message}</div>}
        renderLoading={<div>LOADING</div>}
        render={(res) => <b>{res}</b>}
      />
    </BrowserqlProvider>
  )
}
```

[Sandbox code](https://codesandbox.io/s/browserql-react-provider-znovb)

<Canvas withToolbar className="code-in-ss">
  <Story
    name="Example"
    args={{
      schema: `
        type Foo {
          id: ID!
        }
      `,
    }}
  >
    {Template.bind({})}
  </Story>
</Canvas>

## Props

<ArgsTable of={BrowserqlProvider} />

## Error management

If there is an error, the provider will display it:

<Canvas withToolbar className="code-in-ss">
  <Story
    name="With error"
    args={{
      schema: `extend`,
    }}
  >
    {Template.bind({})}
  </Story>
</Canvas>

You can display your own renderer using a react element

```jsx
<BrowserqlProvider renderError={<div>An error occurred</div>} />
```

<Canvas withToolbar className="code-in-ss">
  <Story
    name="With error element"
    args={{
      schema: `extend`,
      renderError: <div>An error occurred</div>,
    }}
  >
    {Template.bind({})}
  </Story>
</Canvas>

Or with a renderer function

```jsx
<BrowserqlProvider
  renderError={({ error }) => <div>An error occurred: {error.message}</div>}
></BrowserqlProvider>
```

<Canvas withToolbar className="code-in-ss">
  <Story
    name="With error renderer"
    args={{
      schema: `extend`,
      renderError: ({ error }) => <div>An error occurred: {error.message}</div>,
    }}
  >
    {Template.bind({})}
  </Story>
</Canvas>
