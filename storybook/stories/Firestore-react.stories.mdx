import { Meta, Story, Canvas, ArgsTable } from '@storybook/addon-docs/blocks'
import { pick } from 'lodash'
import gql from 'graphql-tag'

import { connectFirestore } from '../../packages/firestore'
import GraphiQL from '../../packages/graphiql'
import { BrowserqlProvider } from '../../packages/react'
import { Firestoreql } from '../../packages/firestore-react'

import makeFirebaseApp from '../firebase'
import FirebaseLoginSB from './Firebase'
import { ExampleCode } from './Firestore-react.tsx'

<Meta
  title="extensions/Firestore React"
  component={BrowserqlProvider}
  argTypes={{
    schema: {
      name: 'GraphQL schema',
      description: 'A valid GraphQL schema',
      control: 'text',
    },
  }}
/>

export const Template = (args) => (
  <BrowserqlProvider
    extensions={[
      connectFirestore(
        makeFirebaseApp(
          pick(args, [
            'API_KEY',
            'AUTHDOMAIN',
            'BASEURL',
            'PROJECT_ID',
            'STORAGEBUCKET',
            'MESSAGING_SENDER_ID',
            'APP_ID',
            'MEASUREMENT_ID',
          ])
        ),
        args.schema
      ),
    ]}
  >
    <FirebaseLoginSB />
    <GraphiQL />
    {args.render}
  </BrowserqlProvider>
)

# Firestore with browserql and react

React integration for [firestore with GraphQL](?path=/docs/extensions-firestore--example)

## Usage

```jsx
import { Firestoreql } from '@browserql/firestore-react'

// Show the list of todos
function Todos() {
  return (
    <Firestoreql paginate="Todo" orderBy="name" limit={10}>
      {(todos) => (
        <ul>
          {todos.map((todo) => (
            <li key={todo.id}>{todo.name}</li>
          ))}
        </ul>
      )}
    </Firestoreql>
  )
}
```

<Canvas withToolbar className="code-in-ss">
  <Story
    name="Example"
    args={{
      schema: `type Todo @firestore(collection: "todos438538483") {
        name: String!
        done: Boolean!
      }`,
      API_KEY: process.env.STORYBOOK_FIREBASE_API_KEY,
      AUTHDOMAIN: process.env.STORYBOOK_FIREBASE_AUTHDOMAIN,
      BASEURL: process.env.STORYBOOK_FIREBASE_BASEURL,
      PROJECT_ID: process.env.STORYBOOK_FIREBASE_PROJECT_ID,
      STORAGEBUCKET: process.env.STORYBOOK_FIREBASE_STORAGEBUCKET,
      MESSAGING_SENDER_ID: process.env.STORYBOOK_FIREBASE_MESSAGING_SENDER_ID,
      APP_ID: process.env.STORYBOOK_FIREBASE_APP_ID,
      MEASUREMENT_ID: process.env.STORYBOOK_FIREBASE_MEASUREMENT_ID,
      render: <ExampleCode />,
    }}
  >
    {Template.bind({})}
  </Story>
</Canvas>
